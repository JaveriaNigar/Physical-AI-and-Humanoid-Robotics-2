---
id: m3-nav2-planning
title: "Lesson 3: Nav2 Path Planning for Humanoids"
sidebar_label: "L3: Nav2 Planning"
description: "Implement autonomous navigation for bipedal humanoid robots using Nav2. Global planning, local planning, and obstacle avoidance."
---

## What is Nav2?

**Nav2** (Navigation 2) is ROS 2's navigation framework. It provides:

-  **Global Planning**: Long-term path from start to goal (RRT*, A*)
-  **Local Planning**: Short-term obstacle avoidance (Dynamic Window Approach)
-  **Cost Maps**: Occupancy grids and layers
-  **Goal Management**: Handle multiple goals and preemption

## Nav2 Architecture

```
SLAM/Localization (pose)
        ↓
Global Costmap (static + dynamic)
        ↓
Global Planner (RRT*, A*) → Global Path
        ↓
Local Costmap (sensors)
        ↓
Local Planner (DWA) → Velocity Commands
        ↓
 Robot Actuators
```

## Installation

```bash
sudo apt-get install ros-humble-navigation2 \
                     ros-humble-nav2-bringup \
                     ros-humble-slam-toolbox
```

## Configure Nav2 for Humanoid

Create `nav2_params.yaml`:

```yaml
bt_navigator:
  ros__parameters:
    use_sim_time: True
    global_frame: map
    robot_base_frame: base_link
    odom_topic: /odometry
    bt_loop_duration: 10
    default_bt_xml_filename: "navigate_w_replanning_and_recovery.xml"
    plugin_lib_names:
      - nav2_compute_path_to_pose_action_bt_node
      - nav2_follow_path_action_bt_node
      - nav2_spin_action_bt_node
      - nav2_wait_action_bt_node

global_costmap:
  global_costmap:
    ros__parameters:
      update_frequency: 1.0
      publish_frequency: 1.0
      global_frame: map
      robot_base_frame: base_link
      use_sim_time: True
      rolling_window: false
      width: 50
      height: 50
      resolution: 0.05
      origin_x: -25.0
      origin_y: -25.0
      plugins: ["static_layer", "obstacle_layer", "inflation_layer"]

      static_layer:
        plugin: nav2_costmap_2d::StaticLayer
        map_subscribe_transient_local: True

      obstacle_layer:
        plugin: nav2_costmap_2d::ObstacleLayer
        enabled: True
        observation_sources: scan
        scan:
          topic: /scan
          max_obstacle_height: 2.0
          clearing: True
          marking: True
          data_type: "LaserScan"

      inflation_layer:
        plugin: nav2_costmap_2d::InflationLayer
        cost_scaling_factor: 3.0
        inflation_radius: 0.55

local_costmap:
  local_costmap:
    ros__parameters:
      update_frequency: 5.0
      publish_frequency: 2.0
      global_frame: map
      robot_base_frame: base_link
      use_sim_time: True
      rolling_window: true
      width: 25
      height: 25
      resolution: 0.05
      robot_radius: 0.2
      plugins: ["obstacle_layer", "inflation_layer"]

      obstacle_layer:
        plugin: nav2_costmap_2d::ObstacleLayer
        enabled: True
        observation_sources: scan
        scan:
          topic: /scan
          max_obstacle_height: 2.0
          clearing: True
          marking: True
          data_type: "LaserScan"

      inflation_layer:
        plugin: nav2_costmap_2d::InflationLayer
        cost_scaling_factor: 3.0
        inflation_radius: 0.25

planner_server:
  ros__parameters:
    expected_planner_frequency: 20.0
    use_sim_time: True
    planner_plugins: ["GridBased"]
    GridBased:
      plugin: nav2_navfn_planner::NavfnPlanner
      tolerance: 0.5
      use_astar: false
      allow_unknown: true

controller_server:
  ros__parameters:
    update_frequency: 10.0
    use_sim_time: True
    controller_frequency: 20.0
    min_x_velocity_threshold: 0.001
    min_y_velocity_threshold: 0.5
    min_theta_velocity_threshold: 0.001
    failure_tolerance: 0.3
    progress_checker_plugin: "progress_checker"
    goal_checker_plugins: ["general_goal_checker"]
    controller_plugins: ["FollowPath"]

    progress_checker:
      plugin: nav2_controller::SimpleProgressChecker
      required_movement_radius: 0.5
      movement_time_allowance: 10.0

    general_goal_checker:
      stateful: True
      plugin: nav2_controller::SimpleGoalChecker
      xy_goal_tolerance: 0.25
      yaw_goal_tolerance: 0.25

    FollowPath:
      plugin: nav2_regulated_pure_pursuit_controller::RegulatedPurePursuitController
      desired_linear_vel: 0.5
      lookahead_dist: 0.6
      min_lookahead_dist: 0.3
      max_lookahead_dist: 0.9
      lookahead_time: 1.5
      rotate_to_heading_angular_vel: 1.8
      transform_tolerance: 0.1
      use_velocity_scaled_lookahead_dist: false
      min_approach_linear_velocity: 0.05
      approach_velocity_scaling_dist: 0.6
      regulated_linear_scaling_min_radius: 0.9
      regulated_linear_scaling_max_radius: 0.55
      use_cost_regulated_linear_velocity_scaling: true
      cost_scaling_dist: 0.6
      cost_scaling_gain: 1.0
      inflation_cost_scaling_factor: 3.0
      collision_margin: 0.10
      inflation_radius: 0.55
      allow_reversing: false
      rehabilitation_indicator_window: 0.0
```

## Launch Nav2

Create `bringup_launch.py`:

```python
from launch import LaunchDescription
from launch_ros.actions import Node, PushRosNamespace
from launch.actions import IncludeLaunchDescription
from launch.launch_description_sources import PythonLaunchDescriptionSource

def generate_launch_description():
    # SLAM/Localization
    slam = Node(
        package='slam_toolbox',
        executable='async_slam_toolbox_node',
        parameters=[{'use_sim_time': True}]
    )

    # Nav2 bringup
    nav2 = IncludeLaunchDescription(
        PythonLaunchDescriptionSource('nav2_bringup_launch.py'),
        launch_arguments={
            'namespace': '',
            'use_namespace': 'false',
            'slam': 'true',
            'map': '',
            'use_sim_time': 'true',
            'params_file': 'nav2_params.yaml',
            'autostart': 'true'
        }.items()
    )

    return LaunchDescription([slam, nav2])
```

Run it:
```bash
ros2 launch my_package bringup_launch.py
```

## Send Navigation Goals

```python
from nav2_simple_commander.robot_navigator import BasicNavigator
from geometry_msgs.msg import PoseStamped

class HumanoidNavigator:
    def __init__(self):
        self.nav = BasicNavigator()

    def navigate_to_goal(self, x, y, theta):
        """Send goal to Nav2."""
        goal_pose = PoseStamped()
        goal_pose.header.frame_id = 'map'
        goal_pose.header.stamp = self.nav.get_clock().now().to_msg()
        goal_pose.pose.position.x = x
        goal_pose.pose.position.y = y
        goal_pose.pose.orientation.z = theta

        self.nav.goToPose(goal_pose)

    def navigate_multiple_goals(self, goals):
        """Navigate to multiple goals in sequence."""
        for x, y, theta in goals:
            print(f"Navigating to ({x}, {y})")
            self.navigate_to_goal(x, y, theta)

            # Wait for completion
            while not self.nav.isTaskComplete():
                feedback = self.nav.getFeedback()
                print(f"Distance to goal: {feedback.distance_remaining:.2f} m")

            result = self.nav.getResult()
            if result:
                print("Goal reached!")
            else:
                print("Failed to reach goal")

# Example usage
navigator = HumanoidNavigator()
goals = [
    (2.0, 0.0, 0.0),      # Move 2m forward
    (2.0, 2.0, 1.57),     # Move right, turn 90°
    (0.0, 2.0, 3.14),     # Move backward, turn 180°
]
navigator.navigate_multiple_goals(goals)
```

## Customize for Bipedal Locomotion

Humanoids have different dynamics than wheeled robots:

```yaml
# In nav2_params.yaml

FollowPath:
  plugin: nav2_regulated_pure_pursuit_controller::RegulatedPurePursuitController
  # Slower for bipedal stability
  desired_linear_vel: 0.3  # Was 0.5
  max_angular_vel: 1.0      # Limit turning speed

  # Larger lookahead for smoother paths
  lookahead_dist: 1.0       # Was 0.6

  # Allow reversing for complex maneuvers
  allow_reversing: true
```

## Module 3 Complete!

You've built a complete autonomous humanoid with:
-  GPU-accelerated perception (VSLAM, object detection)
-  Robust path planning (Nav2)
-  Real-time obstacle avoidance

## Next: Module 4

[Module 4: Vision-Language-Action (VLA)](/docs/modules/m4-vla/m4-overview)
