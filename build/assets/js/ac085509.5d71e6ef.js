"use strict";(self.webpackChunkphysical_ai_humanoid_robotics_textbook=self.webpackChunkphysical_ai_humanoid_robotics_textbook||[]).push([[444],{8453:(e,r,s)=>{s.d(r,{R:()=>o,x:()=>c});var n=s(6540);const i={},t=n.createContext(i);function o(e){const r=n.useContext(t);return n.useMemo(function(){return"function"==typeof e?e(r):{...r,...e}},[r,e])}function c(e){let r;return r=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:o(e.components),n.createElement(t.Provider,{value:r},e.children)}},9453:(e,r,s)=>{s.r(r),s.d(r,{assets:()=>l,contentTitle:()=>c,default:()=>h,frontMatter:()=>o,metadata:()=>n,toc:()=>d});const n=JSON.parse('{"id":"modules/m1-ros2/m1-nodes-topics-services","title":"Lesson 1: ROS 2 Nodes, Topics, and Services","description":"Master the core building blocks of ROS 2: nodes (independent processes), topics (pub-sub communication), and services (request-response).","source":"@site/docs/modules/m1-ros2/m1-nodes-topics-services.mdx","sourceDirName":"modules/m1-ros2","slug":"/modules/m1-ros2/m1-nodes-topics-services","permalink":"/docs/modules/m1-ros2/m1-nodes-topics-services","draft":false,"unlisted":false,"editUrl":"https://github.com/Danishhshahid/Physical-AI-Humanoid-Robotics-Book/tree/main/website/docs/modules/m1-ros2/m1-nodes-topics-services.mdx","tags":[],"version":"current","frontMatter":{"id":"m1-nodes-topics-services","title":"Lesson 1: ROS 2 Nodes, Topics, and Services","sidebar_label":"L1: Nodes, Topics, Services","description":"Master the core building blocks of ROS 2: nodes (independent processes), topics (pub-sub communication), and services (request-response)."},"sidebar":"tutorialSidebar","previous":{"title":"M1: Overview","permalink":"/docs/modules/m1-ros2/m1-overview"},"next":{"title":"L2: Python Agents to ROS","permalink":"/docs/modules/m1-ros2/m1-python-agents"}}');var i=s(4848),t=s(8453);const o={id:"m1-nodes-topics-services",title:"Lesson 1: ROS 2 Nodes, Topics, and Services",sidebar_label:"L1: Nodes, Topics, Services",description:"Master the core building blocks of ROS 2: nodes (independent processes), topics (pub-sub communication), and services (request-response)."},c=void 0,l={},d=[{value:"The Three Pillars of ROS 2",id:"the-three-pillars-of-ros-2",level:2},{value:"1. <strong>Nodes</strong> (Independent Processes)",id:"1-nodes-independent-processes",level:3},{value:"2. <strong>Topics</strong> (Publish-Subscribe)",id:"2-topics-publish-subscribe",level:3},{value:"3. <strong>Services</strong> (Request-Response)",id:"3-services-request-response",level:3},{value:"Writing Your First ROS 2 Node",id:"writing-your-first-ros-2-node",level:2},{value:"Install ROS 2 (Ubuntu 22.04)",id:"install-ros-2-ubuntu-2204",level:3},{value:"Create a Publisher Node",id:"create-a-publisher-node",level:3},{value:"Create a Subscriber Node",id:"create-a-subscriber-node",level:3},{value:"Run Publisher and Subscriber",id:"run-publisher-and-subscriber",level:3},{value:"Creating a Service",id:"creating-a-service",level:2},{value:"Service Definition (.srv file)",id:"service-definition-srv-file",level:3},{value:"Service Server",id:"service-server",level:3},{value:"Service Client",id:"service-client",level:3},{value:"Best Practices",id:"best-practices",level:2},{value:"Next Steps",id:"next-steps",level:2}];function a(e){const r={a:"a",code:"code",h2:"h2",h3:"h3",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,t.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(r.h2,{id:"the-three-pillars-of-ros-2",children:"The Three Pillars of ROS 2"}),"\n",(0,i.jsx)(r.p,{children:"ROS 2 is built on three fundamental concepts:"}),"\n",(0,i.jsxs)(r.h3,{id:"1-nodes-independent-processes",children:["1. ",(0,i.jsx)(r.strong,{children:"Nodes"})," (Independent Processes)"]}),"\n",(0,i.jsxs)(r.p,{children:["A ",(0,i.jsx)(r.strong,{children:"node"})," is a single executable ROS 2 program. Each node does one specific job:"]}),"\n",(0,i.jsxs)(r.ul,{children:["\n",(0,i.jsxs)(r.li,{children:[(0,i.jsx)(r.strong,{children:"Sensor driver node"}),": Reads camera frames, publishes them"]}),"\n",(0,i.jsxs)(r.li,{children:[(0,i.jsx)(r.strong,{children:"Motor control node"}),": Listens for joint commands, sends signals to motors"]}),"\n",(0,i.jsxs)(r.li,{children:[(0,i.jsx)(r.strong,{children:"Path planner node"}),": Computes collision-free trajectories"]}),"\n",(0,i.jsxs)(r.li,{children:[(0,i.jsx)(r.strong,{children:"AI agent node"}),": Runs an LLM to generate action sequences"]}),"\n"]}),"\n",(0,i.jsx)(r.p,{children:"Nodes run independently and communicate via topics or services."}),"\n",(0,i.jsxs)(r.p,{children:[(0,i.jsx)(r.strong,{children:"Key advantage"}),": If one node crashes, others keep running."]}),"\n",(0,i.jsxs)(r.h3,{id:"2-topics-publish-subscribe",children:["2. ",(0,i.jsx)(r.strong,{children:"Topics"})," (Publish-Subscribe)"]}),"\n",(0,i.jsxs)(r.p,{children:[(0,i.jsx)(r.strong,{children:"Topics"})," are named buses for streaming data. Multiple nodes can:"]}),"\n",(0,i.jsxs)(r.ul,{children:["\n",(0,i.jsxs)(r.li,{children:[(0,i.jsx)(r.strong,{children:"Publish"})," (send) data to a topic"]}),"\n",(0,i.jsxs)(r.li,{children:[(0,i.jsx)(r.strong,{children:"Subscribe"})," (listen) to a topic"]}),"\n"]}),"\n",(0,i.jsxs)(r.p,{children:[(0,i.jsx)(r.strong,{children:"Example"}),":"]}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{children:" Camera Node \u2192 publishes to \u2192 /camera/image_raw\r\n\r\n Vision Node \u2192 subscribes to /camera/image_raw \u2192 processes frames\r\n\r\n Control Node \u2192 subscribes to /camera/detections \u2192 moves arm to object\n"})}),"\n",(0,i.jsxs)(r.p,{children:[(0,i.jsx)(r.strong,{children:"Analogy"}),": Topics are like radio stations. Multiple listeners can tune in to the same broadcast."]}),"\n",(0,i.jsxs)(r.h3,{id:"3-services-request-response",children:["3. ",(0,i.jsx)(r.strong,{children:"Services"})," (Request-Response)"]}),"\n",(0,i.jsxs)(r.p,{children:[(0,i.jsx)(r.strong,{children:"Services"})," are like function calls over the network. A client sends a request and waits for a response."]}),"\n",(0,i.jsxs)(r.p,{children:[(0,i.jsx)(r.strong,{children:"Example"}),":"]}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{children:' Plan a path\r\nClient: "Move to position (1.0, 0.5, 0.2)"\r\nServer: "OK, computed 50-step trajectory"\n'})}),"\n",(0,i.jsxs)(r.p,{children:[(0,i.jsx)(r.strong,{children:"Topic vs Service"}),":"]}),"\n",(0,i.jsxs)(r.table,{children:[(0,i.jsx)(r.thead,{children:(0,i.jsxs)(r.tr,{children:[(0,i.jsx)(r.th,{children:"Aspect"}),(0,i.jsx)(r.th,{children:"Topic"}),(0,i.jsx)(r.th,{children:"Service"})]})}),(0,i.jsxs)(r.tbody,{children:[(0,i.jsxs)(r.tr,{children:[(0,i.jsx)(r.td,{children:(0,i.jsx)(r.strong,{children:"Communication"})}),(0,i.jsx)(r.td,{children:"One-way stream"}),(0,i.jsx)(r.td,{children:"Request-Response"})]}),(0,i.jsxs)(r.tr,{children:[(0,i.jsx)(r.td,{children:(0,i.jsx)(r.strong,{children:"Use case"})}),(0,i.jsx)(r.td,{children:"Continuous data (camera, IMU)"}),(0,i.jsx)(r.td,{children:"One-time requests (compute, query)"})]}),(0,i.jsxs)(r.tr,{children:[(0,i.jsx)(r.td,{children:(0,i.jsx)(r.strong,{children:"Latency"})}),(0,i.jsx)(r.td,{children:"Can be high"}),(0,i.jsx)(r.td,{children:"Low, synchronous"})]}),(0,i.jsxs)(r.tr,{children:[(0,i.jsx)(r.td,{children:(0,i.jsx)(r.strong,{children:"Example"})}),(0,i.jsx)(r.td,{children:(0,i.jsx)(r.code,{children:"/camera/image"})}),(0,i.jsx)(r.td,{children:(0,i.jsx)(r.code,{children:"/move_arm"})})]})]})]}),"\n",(0,i.jsx)(r.h2,{id:"writing-your-first-ros-2-node",children:"Writing Your First ROS 2 Node"}),"\n",(0,i.jsx)(r.h3,{id:"install-ros-2-ubuntu-2204",children:"Install ROS 2 (Ubuntu 22.04)"}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-bash",children:"sudo apt install ros-humble-desktop\r\nsource /opt/ros/humble/setup.bash\n"})}),"\n",(0,i.jsx)(r.h3,{id:"create-a-publisher-node",children:"Create a Publisher Node"}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-python",children:"#!/usr/bin/env python3\r\n\r\nimport rclpy\r\nfrom rclpy.node import Node\r\nfrom sensor_msgs.msg import Image\r\nfrom cv_bridge import CvBridge\r\nimport cv2\r\n\r\nclass CameraPublisher(Node):\r\n    def __init__(self):\r\n        super().__init__('camera_publisher')\r\n\r\n        # Create a publisher for camera frames\r\n        self.publisher = self.create_publisher(Image, '/camera/image', 10)\r\n\r\n        # Create a timer to publish every 0.033 seconds (30 Hz)\r\n        timer_period = 0.033\r\n        self.timer = self.create_timer(timer_period, self.timer_callback)\r\n\r\n        self.cv_bridge = CvBridge()\r\n        self.cap = cv2.VideoCapture(0)  # Open webcam\r\n\r\n        self.get_logger().info(\"Camera publisher started\")\r\n\r\n    def timer_callback(self):\r\n        ret, frame = self.cap.read()\r\n        if ret:\r\n            # Convert OpenCV frame to ROS Image message\r\n            img_msg = self.cv_bridge.cv2_to_imgmsg(frame, encoding='bgr8')\r\n            self.publisher.publish(img_msg)\r\n            self.get_logger().debug(f\"Published frame {self.publisher.get_subscription_count()} subscribers\")\r\n\r\ndef main(args=None):\r\n    rclpy.init(args=args)\r\n    node = CameraPublisher()\r\n    rclpy.spin(node)  # Keep node running\r\n    node.destroy_node()\r\n    rclpy.shutdown()\r\n\r\nif __name__ == '__main__':\r\n    main()\n"})}),"\n",(0,i.jsx)(r.h3,{id:"create-a-subscriber-node",children:"Create a Subscriber Node"}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-python",children:"#!/usr/bin/env python3\r\n\r\nimport rclpy\r\nfrom rclpy.node import Node\r\nfrom sensor_msgs.msg import Image\r\nfrom cv_bridge import CvBridge\r\nimport cv2\r\n\r\nclass CameraSubscriber(Node):\r\n    def __init__(self):\r\n        super().__init__('camera_subscriber')\r\n\r\n        # Create a subscriber for camera frames\r\n        self.subscription = self.create_subscription(\r\n            Image,\r\n            '/camera/image',\r\n            self.listener_callback,\r\n            10  # Queue size\r\n        )\r\n\r\n        self.cv_bridge = CvBridge()\r\n        self.get_logger().info(\"Camera subscriber started, waiting for images...\")\r\n\r\n    def listener_callback(self, msg: Image):\r\n        # Convert ROS Image message to OpenCV frame\r\n        frame = self.cv_bridge.imgmsg_to_cv2(msg, desired_encoding='bgr8')\r\n\r\n        # Process the frame (e.g., display it)\r\n        cv2.imshow('Camera Feed', frame)\r\n        cv2.waitKey(1)\r\n\r\n        self.get_logger().debug(f\"Received frame: {msg.header.frame_id}\")\r\n\r\ndef main(args=None):\r\n    rclpy.init(args=args)\r\n    node = CameraSubscriber()\r\n    rclpy.spin(node)\r\n    node.destroy_node()\r\n    rclpy.shutdown()\r\n\r\nif __name__ == '__main__':\r\n    main()\n"})}),"\n",(0,i.jsx)(r.h3,{id:"run-publisher-and-subscriber",children:"Run Publisher and Subscriber"}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-bash",children:"# Terminal 1: Run publisher\r\nros2 run my_package camera_publisher\r\n\r\n# Terminal 2: Run subscriber\r\nros2 run my_package camera_subscriber\r\n\r\n# Terminal 3: Monitor topics\r\nros2 topic list          # List all topics\r\nros2 topic echo /camera/image  # View messages\r\nros2 topic hz /camera/image    # Check publish rate\n"})}),"\n",(0,i.jsx)(r.h2,{id:"creating-a-service",children:"Creating a Service"}),"\n",(0,i.jsx)(r.h3,{id:"service-definition-srv-file",children:"Service Definition (.srv file)"}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{children:"# request\r\nfloat64 x\r\nfloat64 y\r\nfloat64 z\r\n---\r\n# response\r\ngeometry_msgs/Pose target_pose\r\ntrajectory_msgs/JointTrajectory planned_trajectory\n"})}),"\n",(0,i.jsx)(r.h3,{id:"service-server",children:"Service Server"}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-python",children:"from example_interfaces.srv import AddTwoInts\r\n\r\ndef plan_path_callback(request, response):\r\n    # request has x, y, z\r\n    response.target_pose = ...  # Compute IK\r\n    response.planned_trajectory = ...  # Compute trajectory\r\n    return response\r\n\r\nnode.create_service(PlanPath, '/plan_path', plan_path_callback)\n"})}),"\n",(0,i.jsx)(r.h3,{id:"service-client",children:"Service Client"}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-python",children:"client = node.create_client(PlanPath, '/plan_path')\r\n\r\nrequest = PlanPath.Request()\r\nrequest.x, request.y, request.z = 1.0, 0.5, 0.2\r\n\r\nfuture = client.call_async(request)\r\nresponse = future.result()  # Wait for response\r\n\r\nprint(f\"Planned {len(response.planned_trajectory.points)} steps\")\n"})}),"\n",(0,i.jsx)(r.h2,{id:"best-practices",children:"Best Practices"}),"\n",(0,i.jsxs)(r.ol,{children:["\n",(0,i.jsxs)(r.li,{children:["\n",(0,i.jsx)(r.p,{children:(0,i.jsx)(r.strong,{children:"One node = one responsibility"})}),"\n",(0,i.jsxs)(r.ul,{children:["\n",(0,i.jsx)(r.li,{children:"Separate camera driver, vision, and control"}),"\n",(0,i.jsx)(r.li,{children:"Don't put everything in one node"}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(r.li,{children:["\n",(0,i.jsx)(r.p,{children:(0,i.jsx)(r.strong,{children:"Use meaningful topic names"})}),"\n",(0,i.jsxs)(r.ul,{children:["\n",(0,i.jsxs)(r.li,{children:[(0,i.jsx)(r.code,{children:"/arm/joint_commands"}),", ",(0,i.jsx)(r.code,{children:"/camera/depth_image"})]}),"\n",(0,i.jsxs)(r.li,{children:[(0,i.jsx)(r.code,{children:"/data"}),", ",(0,i.jsx)(r.code,{children:"/messages"})]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(r.li,{children:["\n",(0,i.jsx)(r.p,{children:(0,i.jsx)(r.strong,{children:"Set appropriate queue sizes"})}),"\n",(0,i.jsxs)(r.ul,{children:["\n",(0,i.jsx)(r.li,{children:"High-frequency sensors: queue_size=10"}),"\n",(0,i.jsx)(r.li,{children:"Low-frequency requests: queue_size=1"}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(r.li,{children:["\n",(0,i.jsx)(r.p,{children:(0,i.jsx)(r.strong,{children:"Log appropriately"})}),"\n",(0,i.jsxs)(r.ul,{children:["\n",(0,i.jsxs)(r.li,{children:[(0,i.jsx)(r.code,{children:"DEBUG"}),": Detailed per-frame info"]}),"\n",(0,i.jsxs)(r.li,{children:[(0,i.jsx)(r.code,{children:"INFO"}),": Important lifecycle events"]}),"\n",(0,i.jsxs)(r.li,{children:[(0,i.jsx)(r.code,{children:"ERROR"}),": Failures that require attention"]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(r.li,{children:["\n",(0,i.jsx)(r.p,{children:(0,i.jsx)(r.strong,{children:"Handle node shutdown gracefully"})}),"\n",(0,i.jsxs)(r.ul,{children:["\n",(0,i.jsxs)(r.li,{children:["Always call ",(0,i.jsx)(r.code,{children:"destroy_node()"})," and ",(0,i.jsx)(r.code,{children:"shutdown()"})]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(r.h2,{id:"next-steps",children:"Next Steps"}),"\n",(0,i.jsxs)(r.ul,{children:["\n",(0,i.jsx)(r.li,{children:(0,i.jsx)(r.a,{href:"/docs/modules/m1-ros2/m1-python-agents",children:"Lesson 2: Bridging Python Agents to ROS Controllers"})}),"\n",(0,i.jsxs)(r.li,{children:["Hands-on: Create a robot arm controller node that subscribes to ",(0,i.jsx)(r.code,{children:"/arm/target_position"})," and publishes joint angles"]}),"\n",(0,i.jsx)(r.li,{children:"Challenge: Build a node that bridges ChatGPT API to ROS 2 commands"}),"\n"]})]})}function h(e={}){const{wrapper:r}={...(0,t.R)(),...e.components};return r?(0,i.jsx)(r,{...e,children:(0,i.jsx)(a,{...e})}):a(e)}}}]);